class HeaderSearch extends HTMLElement{constructor(){super(),this.buildProductObject(),this.cachedResults={},this.isOpen=!1,this.controller=null,this.isMobile=window.innerWidth<1025,this.buildSelectors(),this.isMobile||this.setModalPosition(),this.setupEventListeners(),this.initialRender(!1)}setModalPosition(){this.isMobile=window.innerWidth<1025;const t=this.getResultsMaxHeight();if(this.isMobile)this.model.style.setProperty("--modelTopPos",t.announcementBottom+"px"),this.model.style.setProperty("--modelMaxHeight","100vh"),this.predictiveSearchResults.style.setProperty("--productContainerMaxHeight","100%");else{const e=window.innerHeight-t.modelTopPos-140;this.model.style.setProperty("--modelTopPos",t.modelTopPos+"px"),this.model.style.setProperty("--modelMaxHeight",t.modelMaxHeight+"px"),this.predictiveSearchResults.style.setProperty("--productContainerMaxHeight",e+"px")}}buildProductObject(){const t=window._theme.headerSearch||null;t&&(this.defaultConfig=t,this.defaultConfig.defaultProducts=this.defaultConfig.defaultProducts||[],this.defaultConfig.defaultProducts=this.defaultConfig.defaultProducts.map((t=>{const e=`/products/${t.handle}`,i=t.variants.map((t=>({...t,available:t.available?"1":"0",image_alt:t.featured_image?t.featured_image.alt:"",image_link:t.featured_image?t.featured_image.src:"",link:`${e}?variant=${t.id}`,list_price:t.compare_at_price?t.compare_at_price/100:null,price:t.price/100,quantity_total:t.inventory_quantity||0,sku:t.sku||"",taxable:t.taxable?"1":"0",variant_id:t.id})));return{...t,product_id:t.id,link:`/products/${t.handle}`,image_link:t.featured_image,shopify_images:t.images||[],tags:t.tags.join("[:ATTR:]"),list_price:t.compare_at_price/100,price:t.price/100,shopify_variants:i}})),this.defaultConfig.defaultProducts=this.defaultConfig.defaultProducts.filter((t=>t.available)),delete window._theme.headerSearch)}buildSelectors(){this.model=this.querySelector("[data-ajax-search-results]"),this.input=this.querySelector("input[data-header-search]"),this.form=this.input.closest("form"),this.formResetBtn=this.form.querySelector('[type="reset"]'),this.predictiveSearchResults=this.querySelector("[data-search-products]"),this.predictiveSearchViewAllBtn=this.querySelector("[data-search-view-all]"),this.overlay=document.querySelector(".wrapper-overlay"),this.closeSearchBtns=this.querySelectorAll("[data-close-search]"),this.trendingSearcheList=this.querySelectorAll("[data-list-trending-searches]"),this.brandsList=this.querySelectorAll("[data-list-brands]"),this.suggestionList=this.querySelectorAll("[data-list-suggestions]"),this.pagesList=this.querySelectorAll("[data-list-pages]"),this.noResultTextNodes=this.querySelectorAll("[data-noresult-block] span"),this.searchIcon=document.querySelector('.site-header .head-search input[name="head-search"]'),this.statusElement=this.statusElement||this.form.querySelector(".predictive-search-status")}setupEventListeners(){const t=this;this.form.addEventListener("submit",this.onFormSubmit.bind(this)),this.input.addEventListener("input",debounce((t=>{this.onChange(t)}),300).bind(this)),this.form.addEventListener("reset",(t=>{this.setAttribute("data-result",!1),this.initialRender(!1),this.close(),this.controller&&this.controller.abort()})),this.closeSearchBtns.forEach((e=>{e.addEventListener("click",(function(e){t.close(!0)}))})),this.input.addEventListener("focus",this.onFocus.bind(this)),this.addEventListener("focusout",this.onFocusOut.bind(this)),this.predictiveSearchViewAllBtn.addEventListener("click",(t=>{t.preventDefault();const e=this.getQuery();window.location.href="/search?q="+encodeURIComponent(e)})),this.isMobile&&this.searchIcon.addEventListener("focus",(t=>{t.preventDefault(),this.open(),this.input.focus()})),this.isMobile||(window.onresize=debounce((t=>{this.setModalPosition()})))}getQuery(){return this.input.value.trim()}onChange(){this.input.removeAttribute("aria-invalid"),this.removeAttribute("data-empty");const t=this.getQuery();if(this.noResultTextNodes.forEach((e=>e.innerHTML='"'+t+'"')),this.form.querySelector('input[name="q"]').value=t,!t.length)return this.setAttribute("data-result",!1),this.initialRender(),void this.setLiveRegionText("found top trending searches & prodducts");this.setAttribute("data-result",!0),this.getSearchResults(t)}onFormSubmit(t){this.getQuery().length&&!this.querySelector('[aria-selected="true"] a')||t.preventDefault()}onFocus(){this.open();const t=this.getQuery();t.length&&("true"===this.getAttribute("results")?this.open():this.getSearchResults(t))}onFocusOut(t){const e=this.contains(t.target),i=!t.relatedTarget||this.contains(t.relatedTarget);setTimeout((()=>{e&&i||this.close()}))}onKeyup(t){switch(this.getQuery().length||this.close(!0),t.preventDefault(),t.code){case"ArrowUp":this.switchOption("up");break;case"ArrowDown":this.switchOption("down");break;case"Enter":this.selectOption()}}onKeydown(t){"ArrowUp"!==t.code&&"ArrowDown"!==t.code||t.preventDefault()}switchOption(t){if(!this.getAttribute("open"))return;const e="up"===t,i=this.querySelector('[aria-selected="true"]'),s=this.querySelectorAll("li");let a=this.querySelector("li");e&&!i||(this.statusElement.textContent="",!e&&i?a=i.nextElementSibling||s[0]:e&&(a=i.previousElementSibling||s[s.length-1]),a!==i&&(a.setAttribute("aria-selected",!0),i&&i.setAttribute("aria-selected",!1),this.setLiveRegionText(a.textContent),this.input.setAttribute("aria-activedescendant",a.id)))}selectOption(){const t=this.querySelector('[aria-selected="true"] a, [aria-selected="true"] button');t&&t.click()}getSearchResults(t){const e=t.toLowerCase();this.setLiveRegionLoadingState();const i=this.cachedResults[e];if(i)return void(0===i.totalItems?this.renderEmptyResult(i):this.renderSearchResults(i));this.controller&&this.controller.abort(),this.controller=new AbortController;const s=this.controller.signal;this.form.setAttribute("data-loading",!0);fetch(`https://searchserverapi.com/getwidgets?api_key=2K7F7z9Y9V&output=jsonp&items=true&maxResults=8&suggestions=true&suggestionsMaxResults=5&pages=true&pagesMaxResults=10&categories=true&categoryStartIndex=0&categoriesMaxResults=5&q=${encodeURIComponent(t)}`,{signal:s}).then((t=>{if(!t.ok){var e=new Error(t.status);throw this.close(),e}return t.json()})).then((t=>{this.cachedResults[e]=t,0===t.totalItems?this.renderEmptyResult(t):this.renderSearchResults(t),this.controller=null})).catch((t=>{throw t}))}setLiveRegionLoadingState(){this.statusElement=this.statusElement||this.form.querySelector(".predictive-search-status"),this.loadingText=this.loadingText||this.getAttribute("data-loading-text"),this.setLiveRegionText(this.loadingText),this.setAttribute("loading",!0)}setLiveRegionText(t){this.statusElement.setAttribute("aria-hidden","false"),this.statusElement.textContent=t,setTimeout((()=>{this.statusElement.setAttribute("aria-hidden","true")}),1e3)}initialRender(t=!0){if(!this.defaultConfig)return;this.setAttribute("data-result",!1);let e="",i="";this.defaultConfig.defaultSuggestions.length&&(e=this.buildSuggestionList(this.defaultConfig.defaultSuggestions)),this.defaultConfig.defaultProducts.length&&(i=this.buildProductGrid(this.defaultConfig.defaultProducts.slice(0,10))),""!==e&&this.trendingSearcheList.forEach((t=>{t.closest(".search-result-col-row").classList.toggle("hidden",""===e),t.innerHTML=e})),""!==i&&(this.predictiveSearchResults.innerHTML=i),this.predictiveSearchViewAllBtn.classList.add("hidden"),this.form.removeAttribute("data-loading"),t&&this.open()}renderSearchResults(t){if(!t.totalItems||0===t.totalItems)return;this.removeAttribute("data-empty");const e=t.totalItems,i=this.buildBrandsList(t.categories),s=this.buildSuggestionList(t.suggestions),a=this.buildSuggestionList(this.defaultConfig.defaultSuggestions),r=this.buildPagesList(t.pages),n=this.buildProductGrid(t.items.slice(0,12));this.brandsList.forEach((t=>{t.closest(".search-result-col-row").classList.toggle("hidden",""===i),t.innerHTML=i})),this.suggestionList.forEach((t=>{t.closest(".search-result-col-row").classList.toggle("hidden",""===s),t.innerHTML=s})),this.trendingSearcheList.forEach((t=>{t.closest(".search-result-col-row").classList.toggle("hidden",""===a),t.innerHTML=a})),this.pagesList.forEach((t=>{t.closest(".search-result-col-row").classList.toggle("hidden",""===r),t.innerHTML=r})),this.predictiveSearchResults.innerHTML=n,this.predictiveSearchViewAllBtn.innerHTML="View All "+e+" Products",this.setAttribute("results",!0),this.setLiveRegionResults(e),e>8?this.predictiveSearchViewAllBtn.classList.remove("hidden"):this.predictiveSearchViewAllBtn.classList.add("hidden"),this.form.removeAttribute("data-loading"),this.open()}renderEmptyResult(t){this.input.setAttribute("aria-invalid",!0),this.setLiveRegionText("Sorry, nothing found for the search term "+this.getQuery()),this.setAttribute("data-empty",!0),this.initialRender(!1)}updateHtml(t,e,i){var s=t;return s.indexOf(e)>-1?(s=s.replace(e,i),this.updateHtml(s,e,i)):s}buildBrandsList(t){if(!t||0===t.length)return"";let e='<ul role="list">';return t.forEach((function(t){const i=t.title.length>20?"...":"";e+='<li role="listitem"><a class="outline-inset" href="'+t.link+'">'+t.title.slice(0,20)+i+"</a></li>"})),e}buildSuggestionList(t){if(!t||0===t.length)return"";let e='<ul role="list">';return t.forEach((function(t){e+='<li role="listitem"><a class="outline-inset" href="'+window.routes.search_url+"?q="+encodeURI(t)+'">'+t+"</a></li>"})),e}buildPagesList(t){if(!t||0===t.length)return"";const e=t.filter((t=>t.link.includes("/blogs/"))).slice(0,3);if(0===e.length)return"";let i='<ul role="list">';return e.forEach((function(t){i+='<li role="listitem"><a class="outline-inset" href="'+t.link+'">'+t.title+"</a></li>"})),i}buildProductGrid(t){if(!t||0===t.length)return"";const e=this;let i="";function s(t){let e=0,i=null,s=0,a=null;t.shopify_variants&&t.shopify_variants.length>0&&t.shopify_variants.forEach((function(t){const r=Number(t.list_price);if(!r||r<=0)return!1;const n=Number(t.price),o=Math.ceil(r-n);o>e&&(e=o,i=t),o>s&&Number(t.available)&&(s=o,a=t)}));const r=Number(t.discount),n=Number(t.list_price);if(!e&&r>0&&n>0){const i=Math.floor(100*(t.list_price-t.price)/t.list_price);e=r||i}return{maxDiscount:e,maxDiscountVariant:i,availableMaxDiscount:s,availableMaxDiscountVariant:a}}return t.map((function(t,a){let r=_theme.product_html.productGridHeaderSearch,n="",o=t.shopify_variants.filter((function(t){return JSON.parse(t.available)}))[0];const l=s(t),u=l.availableMaxDiscountVariant&&l.availableMaxDiscountVariant.link||t.link;n=o?o.variant_id:t.shopify_variants[0].variant_id,r=e.updateHtml(r,"[[Product_Id]]",t.product_id),r=e.updateHtml(r,"[[Product_Title]]",t.title),r=e.updateHtml(r,"[[Variant_Id]]",n),r=e.updateHtml(r,"[[Product_URL]]",u);var c=t.image_link||"https://cdn.shopify.com/shopifycloud/shopify/assets/no-image-2048-5e88c1b20e087fb7bbe9a3771824e743c244f437e4f8ba93bbf7b11b53f7824c.gif",d=null;c+=-1===c.indexOf("?")?"?width=200":"&width=200",t.shopify_images&&t.shopify_images.length>1&&(d=t.shopify_images[1],d+=-1===d.indexOf("?")?"?width=200":"&width=200");var h="<img sizes='200' data-sizes='200' loading='lazy' src='data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==' data-src='"+c+"' alt='' class='lazyload' />";if(r=e.updateHtml(r,"[[Product_Image_1]]",h),t.shopify_images&&t.shopify_images.length>1){var p="<span class='images-two'><img sizes='200' data-sizes='200' src='data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==' data-src='"+d+"' alt='"+t.title+"' class='lazyload' loading='lazy' /></span>";r=e.updateHtml(r,"[[Product_Image_2]]",p),r=e.updateHtml(r,"[[Image_1_Class]]","images-one")}else r=e.updateHtml(r,"[[Image_1_Class]]",""),r=e.updateHtml(r,"[[Product_Image_2]]","");const f=function(t){if(!t.tags||""===t.tags)return"";let e="";const i=t.tags.trim().toLowerCase();if(i.includes("bundle-2-for-75"))return e;i.includes("bogo-discount")&&!i.includes("discount-amount:")&&(e='<div class="price-box"><div class="price-regular"><span class = "bogoTextContainer"><span class="text">BOGO</span><span class="discount_text">50%</span><span class="discount_text">OFF</span></span></div></div>');return e}(t);r=e.updateHtml(r,"[[Product_Vendor]]",t.vendor||""),r=e.updateHtml(r,"[[Product_Vendor_Url]]","/collections/"+e.handleize(t.vendor)||""),r=e.updateHtml(r,"[[Product_Handle]]",t.link.replace("/products/","")),r=e.updateHtml(r,"[[Grid_Class]]",function(t){let e="";const i=t.shopify_variants.filter((function(t){return"0"!=t.available}));e=i.length?"available":"sold_out";return e}(t)),r=e.updateHtml(r,"[[Product_Price]]",function(t){let e=!1,i=t.shopify_variants.filter((function(t){return"0"!=t.available}))[0],s=t.shopify_variants.map((function(t){return Number(t.price)}));i||(e=!0);const a=Shopify.formatMoney(100*t.price,window.money_format);let r='<div class="sale-price pink_color"><span class="visually-hidden">Sale price '+a+'</span><span aria-hidden="true">'+a+"</span></div>";if(s.length>1){const t=Math.min.apply(null,s),e=Math.max.apply(null,s);if(t!==e){const i=Shopify.formatMoney(100*t,window.money_format),s=Shopify.formatMoney(100*e,window.money_format);r='<div class="sale-price pink_color"><span class="visually-hidden">Price range from '+i+" to "+s+'</span><span aria-hidden="true">'+i+" - "+s+"</span></div>"}}return r}(t)),r=e.updateHtml(r,"[[Product_Labels]]",function(t){if(!t.tags||""===t.tags)return"";let i="";const s=t.tags.trim().toLowerCase(),a=t.shopify_variants.filter((function(t){return JSON.parse(t.available)}))[0];a&&0!==Number(t.quantity)&&""!==t.quantity_total||(i+='<div class="new-tag-style soldout">Out of stock</div>');s.includes("bundle-2-for-75")&&(i='<div class="customOff new">2 for $75 | Mix &amp; Match</div>');if(s.includes("bogo-discount")&&(e.isMobile&&(i='<p class="customOff new">BOGO 50% off</p>'),s.includes("discount-amount:"))){const t=s.split("[:attr:]").find((t=>t.includes("discount-amount:")));if(t){const s=t.split(":")[1];i=e.isMobile?'<p class="customOff new">Buy 1 get 1 at '+s+"% off | Mix & Match</p>":'<p class="customOff new">Buy 1 get 1 at '+s+"% off<br>Mix & Match</p>"}}return i}(t)),r=e.updateHtml(r,"[[Product_PriceOff_Label]]",function(t){let e="";if(t.tags&&""!==t.tags){const e=t.tags.trim().toLowerCase();if(e.includes("bogo-discount")||e.includes("bundle-2-for-75"))return""}const i=s(t),a=i.maxDiscountVariant;if(a&&i.maxDiscount){const t=i.maxDiscount;e=`\n              <div class="price-box">\n\n                  <div class="price-regular">\n\n                      <span class="custom-discount" data-old-price=${a.list_price}   data-current-price=${a.price}>\n\n                        <span class="text" aria-hidden="true" >\n                          Up to\n                        </span>\n\n                        <span aria-hidden="true" class="discount_text"> \n                        $ ${t} \n                        </span>\n\n                        <span aria-hidden="true" class="discount_text">Off</span>\n                        <span class="visually-hidden">Up to $ ${t} <span>  Off</span></span>\n                      </span>\n\n\n\n                  </div>\n\n              </div>\n              \n              `}return e}(t)),r=e.updateHtml(r,"[[Product_Notify_CTA]]",""),r=e.updateHtml(r,"[[Product_Quick_Add_Swatch]]",""),"string"==typeof f?(r=e.updateHtml(r,"[[Product_Bogo_Label]]",f),r=e.updateHtml(r,"[[MIXMATCH_CLASS]]","")):(r=e.updateHtml(r,"[[Product_Bogo_Label]]",f.html),r=e.updateHtml(r,"[[MIXMATCH_CLASS]]",f.mixmatch?"has-mixmatch":"")),i+=r})),i}handleize(t){return t.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/-$/,"").replace(/^-/,"")}setLiveRegionResults(t){const e=this.getQuery();this.removeAttribute("loading"),this.setLiveRegionText(t+" products found for the search term "+e)}getResultsMaxHeight(){const t=document.getElementById("shopify-section-announcement-bar").getBoundingClientRect().bottom,e=document.getElementById("shopify-section-navigation").getBoundingClientRect().bottom;return this.resultsMaxHeight=window.innerHeight-e,{modelMaxHeight:this.resultsMaxHeight,modelTopPos:e,announcementBottom:t}}open(){document.body.classList.add("search-active","overflow-hidden"),this.formResetBtn.setAttribute("tabindex",0),this.setAttribute("open",!0),this.isOpen=!0,this.isMobile||this.setModalPosition(),_theme.focusTrap($(this),(()=>{this.close(!0)}),null,!0)}close(t){t&&(this.input.value="",this.removeAttribute("results"));const e=this.querySelector('[aria-selected="true"]');e&&e.setAttribute("aria-selected",!1),this.removeAttribute("open"),this.input.setAttribute("aria-activedescendant",""),this.resultsMaxHeight=!1,this.predictiveSearchResults.removeAttribute("style"),document.body.classList.remove("search-active","overflow-hidden"),this.form.removeAttribute("data-loading"),this.formResetBtn.setAttribute("tabindex",-1),this.isOpen=!1}}window.addEventListener("DOMContentLoaded",(function(){if(window.innerWidth<1025){const t=document.querySelector(".site-header .head-search"),e=document.querySelector("header-search");t&&e&&t.append(e)}customElements.define("header-search",HeaderSearch)}));